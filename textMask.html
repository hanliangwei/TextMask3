<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图像文字蒙版处理工具</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1000px;
            overflow: hidden;
        }
        
        header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        header p {
            opacity: 0.8;
            font-size: 16px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            padding: 25px;
        }
        
        @media (min-width: 992px) {
            .main-content {
                flex-direction: row;
            }
            
            .upload-section {
                flex: 1.5; /* 增加图片区域宽度 */
            }
            
            .editor-section {
                flex: 1;
            }
        }
        
        .upload-section {
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .editor-section {
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        
        .canvas-container {
            position: relative;
            width: 100%;
            height: 450px; /* 增加高度 */
            margin: 15px 0;
            border: 2px dashed #3498db;
            border-radius: 10px;
            overflow: hidden;
            background: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #imageCanvas {
            max-width: 100%;
            max-height: 100%;
            display: none;
        }
        
        .placeholder-text {
            color: #7f8c8d;
            text-align: center;
            padding: 20px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 767px) {
            .controls {
                grid-template-columns: 1fr;
            }
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input[type="text"],
        input[type="range"],
        input[type="color"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input[type="range"] {
            padding: 0;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-download {
            background: #2ecc71;
        }
        
        .btn-download:hover {
            background: #27ae60;
        }
        
        .instructions {
            background: #e8f4fc;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .instructions h3 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .instructions ol {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        footer {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .drag-over {
            border: 2px dashed #2ecc71;
            background: #e8f4fc;
        }
        
        /* 字体预览样式 */
        #fontPreview {
            margin-top: 10px;
            padding: 10px;
            background: #f1f2f6;
            border-radius: 8px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>图像文字蒙版处理工具</h1>
            <p>上传图片，添加文字，创建文字蒙版效果</p>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <h2>上传图片</h2>
                <div class="canvas-container" id="dropZone">
                    <canvas id="imageCanvas"></canvas>
                    <div class="placeholder-text" id="placeholderText">
                        <p>点击按钮或拖拽图片到此处</p>
                        <p>支持 JPG, PNG 格式</p>
                    </div>
                </div>
                <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                <button class="btn" id="uploadBtn">选择图片</button>
            </div>
            
            <div class="editor-section">
                <h2>文字编辑</h2>
                <div class="control-group">
                    <label for="textInput">文字内容</label>
                    <input type="text" id="textInput" placeholder="输入文字内容" value="示例文字">
                </div>
                
                <div class="control-group">
                    <label for="fontFamily">字体选择</label>
                    <select id="fontFamily">
                        <option value="Arial">Arial</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Tahoma">Tahoma</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Courier New">Courier New</option>
                        <option value="Impact">Impact</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                        <option value="Trebuchet MS">Trebuchet MS</option>
                        <option value="Palatino">Palatino</option>
                        <option value="Garamond">Garamond</option>
                        <option value="Bookman">Bookman</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="sans-serif">无衬线体</option>
                        <option value="serif">衬线体</option>
                        <option value="monospace">等宽字体</option>
                    </select>
                    <div id="fontPreview">字体预览</div>
                </div>
                
                <div class="controls">
                    <div class="control-group">
                        <label for="fontSize">文字大小: <span id="fontSizeValue">48</span>px</label>
                        <input type="range" id="fontSize" min="12" max="120" value="48">
                    </div>
                    
                    <div class="control-group">
                        <label for="fontWeight">文字粗细: <span id="fontWeightValue">normal</span></label>
                        <select id="fontWeight">
                            <option value="normal">正常</option>
                            <option value="bold">粗体</option>
                            <option value="bolder">更粗</option>
                            <option value="lighter">细体</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="textX">水平位置: <span id="textXValue">50</span>%</label>
                        <input type="range" id="textX" min="0" max="100" value="50">
                    </div>
                    
                    <div class="control-group">
                        <label for="textY">垂直位置: <span id="textYValue">50</span>%</label>
                        <input type="range" id="textY" min="0" max="100" value="50">
                    </div>
                </div>
                
                <button class="btn btn-download" id="downloadBtn">下载蒙版图像</button>
                
                <div class="instructions">
                    <h3>使用说明</h3>
                    <ol>
                        <li>上传一张图片（支持 JPG/PNG 格式）</li>
                        <li>在右侧编辑文字内容和样式</li>
                        <li>选择喜欢的字体并调整大小、粗细</li>
                        <li>调整文字在图片上的位置</li>
                        <li>点击"下载蒙版图像"按钮</li>
                        <li>下载的图片将只保留文字区域，其余部分透明</li>
                    </ol>
                </div>
            </div>
        </div>
        
        <footer>
            <p>图像文字蒙版处理工具 &copy; 2023 | 仅用于学习和演示</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM 元素
            const imageUpload = document.getElementById('imageUpload');
            const uploadBtn = document.getElementById('uploadBtn');
            const dropZone = document.getElementById('dropZone');
            const imageCanvas = document.getElementById('imageCanvas');
            const placeholderText = document.getElementById('placeholderText');
            const textInput = document.getElementById('textInput');
            const fontFamily = document.getElementById('fontFamily');
            const fontPreview = document.getElementById('fontPreview');
            const fontSize = document.getElementById('fontSize');
            const fontSizeValue = document.getElementById('fontSizeValue');
            const fontWeight = document.getElementById('fontWeight');
            const fontWeightValue = document.getElementById('fontWeightValue');
            const textX = document.getElementById('textX');
            const textXValue = document.getElementById('textXValue');
            const textY = document.getElementById('textY');
            const textYValue = document.getElementById('textYValue');
            const downloadBtn = document.getElementById('downloadBtn');
            
            // 状态变量
            let originalImage = null;
            let ctx = null;
            
            // 事件监听器
            uploadBtn.addEventListener('click', () => imageUpload.click());
            imageUpload.addEventListener('change', handleImageUpload);
            
            // 拖拽上传
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length) {
                    imageUpload.files = e.dataTransfer.files;
                    handleImageUpload();
                }
            });
            
            // 文字设置变化监听
            textInput.addEventListener('input', updateCanvas);
            fontFamily.addEventListener('change', function() {
                updateFontPreview();
                updateCanvas();
            });
            fontSize.addEventListener('input', function() {
                fontSizeValue.textContent = this.value;
                updateFontPreview();
                updateCanvas();
            });
            fontWeight.addEventListener('change', function() {
                fontWeightValue.textContent = this.options[this.selectedIndex].text;
                updateFontPreview();
                updateCanvas();
            });
            textX.addEventListener('input', function() {
                textXValue.textContent = this.value;
                updateCanvas();
            });
            textY.addEventListener('input', function() {
                textYValue.textContent = this.value;
                updateCanvas();
            });
            
            downloadBtn.addEventListener('click', downloadImage);
            
            // 更新字体预览
            function updateFontPreview() {
                fontPreview.textContent = textInput.value || '字体预览';
                fontPreview.style.fontFamily = fontFamily.value;
                fontPreview.style.fontSize = fontSize.value + 'px';
                fontPreview.style.fontWeight = fontWeight.value;
            }
            
            // 处理图片上传
            function handleImageUpload() {
                const file = imageUpload.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        originalImage = img;
                        setupCanvas();
                        updateCanvas();
                        updateFontPreview();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            // 设置画布
            function setupCanvas() {
                const container = dropZone;
                const maxWidth = container.clientWidth - 20;
                const maxHeight = container.clientHeight - 20;
                
                // 计算缩放比例
                let scale = Math.min(maxWidth / originalImage.width, maxHeight / originalImage.height, 1);
                let canvasWidth = originalImage.width * scale;
                let canvasHeight = originalImage.height * scale;
                
                // 设置画布尺寸
                imageCanvas.width = canvasWidth;
                imageCanvas.height = canvasHeight;
                imageCanvas.style.display = 'block';
                placeholderText.style.display = 'none';
                
                ctx = imageCanvas.getContext('2d');
            }
            
            // 更新画布显示
            function updateCanvas() {
                if (!originalImage || !ctx) return;
                
                // 清空画布
                ctx.clearRect(0, 0, imageCanvas.width, imageCanvas.height);
                
                // 绘制原始图片
                ctx.drawImage(originalImage, 0, 0, imageCanvas.width, imageCanvas.height);
                
                // 设置文字样式
                ctx.font = `${fontWeight.value} ${fontSize.value}px ${fontFamily.value}`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)'; // 半透明白色用于预览
                
                // 计算文字位置
                const x = (textX.value / 100) * imageCanvas.width;
                const y = (textY.value / 100) * imageCanvas.height;
                
                // 绘制文字
                ctx.fillText(textInput.value, x, y);
            }
            
            // 下载蒙版图像
            function downloadImage() {
                if (!originalImage || !ctx) {
                    alert('请先上传一张图片');
                    return;
                }
                
                // 创建临时画布用于生成蒙版
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                // 设置临时画布尺寸为原始图片尺寸
                tempCanvas.width = originalImage.width;
                tempCanvas.height = originalImage.height;
                
                // 绘制原始图片
                tempCtx.drawImage(originalImage, 0, 0);
                
                // 创建文字蒙版
                tempCtx.globalCompositeOperation = 'destination-in';
                
                // 设置文字样式（按原始图片比例缩放）
                const scaleFactor = originalImage.width / imageCanvas.width;
                tempCtx.font = `${fontWeight.value} ${fontSize.value * scaleFactor}px ${fontFamily.value}`;
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                tempCtx.fillStyle = 'white';
                
                // 计算文字位置（按原始图片比例）
                const x = (textX.value / 100) * originalImage.width;
                const y = (textY.value / 100) * originalImage.height;
                
                // 绘制文字作为蒙版
                tempCtx.fillText(textInput.value, x, y);
                
                // 创建下载链接
                const link = document.createElement('a');
                link.download = 'text-mask-image.png';
                link.href = tempCanvas.toDataURL('image/png');
                link.click();
            }
            
            // 初始化字体预览
            updateFontPreview();
        });
    </script>
</body>
</html>